{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load cart_filters %}

<div class="p-3">
  <div class="container">
    <div class="row mt-3">
      <div class="col mx-auto mb-3">
        <h2>Shopping Carts</h2>
        <hr />
      </div>
    </div>

    <!-- Cart Selection -->
    <div class="row mb-4">
      <div class="col-12">
        <h4>Select a Cart to View:</h4>
        <div class="row">
          {% for cart in template_data.carts %}
          <div class="col-md-4 mb-2">
            <a href="{% url 'cart.index' %}?cart_id={{ cart.id }}" 
               class="btn btn-outline-primary w-100 {% if template_data.selected_cart.id == cart.id %}active{% endif %}">
              {{ cart.get_cart_type_display }}
              <small class="d-block">({{ cart.items.count }} items)</small>
            </a>
          </div>
          {% empty %}
          <div class="col-12">
            <p class="text-muted">No carts available. Add items to create carts.</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Selected Cart Contents -->
    {% if template_data.selected_cart %}
    <div class="row">
      <div class="col-12">
        <h4>{{ template_data.selected_cart.get_cart_type_display }} Contents</h4>
        <hr />
        
        {% if template_data.cart_items %}
        <table class="table table-bordered table-striped text-center mt-3">
          <thead>
            <tr>
              <th scope="col">Movie</th>
              <th scope="col">Price</th>
              <th scope="col">Quantity</th>
              <th scope="col">Total</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in template_data.cart_items %}
            <tr>
              <td>{{ item.movie.name }}</td>
              <td>${{ item.movie.price }}</td>
              <td>{{ item.quantity }}</td>
              <td>${{ item.movie.price|mul:item.quantity }}</td>
              <td>
                <a href="{% url 'cart.remove_item' cart_id=template_data.selected_cart.id item_id=item.id %}" 
                   class="btn btn-sm btn-danger">Remove</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        
        <div class="row">
          <div class="col-12 text-end">
            <div class="d-inline-block me-3">
              <strong>Total: ${{ template_data.cart_total }}</strong>
            </div>
            <a href="{% url 'cart.checkout' cart_id=template_data.selected_cart.id %}" 
               class="btn bg-dark text-white me-2">Checkout</a>
            <a href="{% url 'cart.clear_cart' cart_id=template_data.selected_cart.id %}" 
               class="btn btn-danger">Clear Cart</a>
          </div>
        </div>
        {% else %}
        <div class="alert alert-info">
          <h5>Cart is Empty</h5>
          <p>Add some movies to this cart to get started!</p>
          <a href="{% url 'movies.index' %}" class="btn btn-primary">Browse Movies</a>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

{% endblock content %}